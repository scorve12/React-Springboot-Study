services:
  # Spring Boot Backend (프로덕션 빌드 - Oracle Cloud DB 연결)
  springboot:
    build:
      context: ./back-end
      dockerfile: Dockerfile
    container_name: springboot_app
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: oracle
      ORACLE_URL: ${ORACLE_URL:-jdbc:oracle:thin:@//your-oracle-cloud-host:1521/your-service-name}
      ORACLE_USER: ${ORACLE_USER:-board_user}
      ORACLE_PASSWORD: ${ORACLE_PASSWORD:-Produck1234!@}
      # JVM 메모리 최적화
      JAVA_OPTS: -Xms128m -Xmx256m -XX:+UseSerialGC -XX:MaxMetaspaceSize=128m
    deploy:
      resources:
        limits:
          memory: 384M
        reservations:
          memory: 256M
    networks:
      - app-network

  # React Frontend (프로덕션 빌드 - Nginx)
  react:
    build:
      context: ./front-end
      dockerfile: Dockerfile.prod
      args:
        REACT_APP_API_URL: ""
    container_name: react_app
    restart: unless-stopped
    ports:
      - "80:80"
    deploy:
      resources:
        limits:
          memory: 64M
        reservations:
          memory: 32M
    depends_on:
      - springboot
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
